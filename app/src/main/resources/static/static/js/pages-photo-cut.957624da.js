(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-photo-cut"],{1007:function(t,e,a){"use strict";a.r(e);var i=a("8266"),n=a.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},"254d":function(t,e,a){var i=a("27ba");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("4bd5d95e",i,!0,{sourceMap:!1,shadowMode:!1})},"27ba":function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,".content[data-v-ab835db4]{position:fixed;display:flex;flex-direction:column;height:100%;width:100%}.img[data-v-ab835db4]{flex:1;position:relative;height:100%;overflow:hidden}.img > uni-canvas[data-v-ab835db4]{position:absolute;height:100%;width:100%;top:-9000px}#main-canvas[data-v-ab835db4]{top:-9000px}.mask[data-v-ab835db4]{position:absolute;top:0;height:100%;width:100%;display:grid}.mask > uni-view[data-v-ab835db4]{background-color:rgba(0,0,0,.5254901960784314);position:relative}.r90[data-v-ab835db4]{top:0;right:10px;color:#fff;height:100%;text-align:center;-webkit-writing-mode:tb-rl;writing-mode:tb-rl}.mask > uni-view > uni-text[data-v-ab835db4]{position:absolute}.background[data-v-ab835db4]{width:100%;height:100%;position:absolute;top:0;z-index:-1}.banner-view[data-v-ab835db4]{padding:%?40?% %?20?%;background-color:#fff;display:flex;flex-direction:row}",""]),t.exports=e},"528a":function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("5530")),s=i(a("e143")),o=a("d4e5"),c=a("4e88"),l=a("3ddc"),r=a("60b7"),u=a("7742"),d=a("4844"),h=a("dc64"),f=a("6e89"),v=a("4d9c"),p=s.default.extend((0,n.default)((0,n.default)({},o.pageLifetimes),{},{methods:{clone:c.clone,handleDataset:l.handleDataset,escape2Html:r.escape2Html,html2Escape:r.html2Escape,parseEventDynamicCode:u.parseEventDynamicCode,getTabBar:d.getTabBar,getRelationNodes:h.getRelationNodes,zpSelectComponent:f.selectComponent,zpSelectAllComponents:f.selectAllComponents,setData:v.setData}}));e.default=p},"5af9":function(t,e,a){"use strict";a.r(e);var i=a("de74"),n=a("1007");for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);a("99b3");var o=a("f0c5"),c=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"ab835db4",null,!1,i["a"],void 0);e["default"]=c.exports},8266:function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("e9c4"),a("ac1f");var n=i(a("c7eb")),s=i(a("1da1")),o=i(a("528a")),c=a("fe9a"),l=a("870e"),r=a("cc37"),u={x1:0,y1:0,x2:0,y2:0},d=o.default.extend({data:function(){return{file:null,originImg:null,stv:{offsetX:0,offsetY:0,zoom:!1,distance:0,scale:1,rotate:0},imgRect:{x:0,y:0,w:0,h:0},photoSetting:null,dpr:1,touchStartEvent:[],startX:0,startY:0}},onLoad:function(t){var e=this;return(0,s.default)((0,n.default)().mark((function a(){var i,s,o,r;return(0,n.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=uni.getSystemInfoSync().pixelRatio,s=c.photoItems[t.type],e.setData({photoSetting:s,dpr:i,file:t.file}),a.next=5,(0,l.getRect)("top-view");case 5:return o=a.sent,a.next=8,(0,l.getRect)("left-view");case 8:r=a.sent,e.setData({imgRect:{x:r.right,y:o.bottom,w:s.pixelWidth,h:s.pixelHeight}}),e.initImg(t.file);case 11:case"end":return a.stop()}}),a)})))()},onReady:function(){},methods:{initImg:function(t){var e=this;return(0,s.default)((0,n.default)().mark((function a(){var i,s,o,c;return(0,n.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=e,a.next=3,(0,l.getRect)("img");case 3:s=a.sent,o=(null===s||void 0===s?void 0:s.width)||0,c=(null===s||void 0===s?void 0:s.height)||0,console.log(s),uni.getImageInfo({src:t,success:function(e){var a=e.width/e.height,n=o/c,s=a>n?o:c*a,l=a>n?o/a:c;i.setData({originImg:{url:t,width:s,height:l},stv:{offsetX:(o-s)/2,offsetY:(c-l)/2,zoom:!1,distance:0,scale:1,rotate:0}})}});case 8:case"end":return a.stop()}}),a)})))()},touchstartCallback:function(t){if(1===t.touches.length){var e=t.touches[0],a=e.clientX,i=e.clientY;this.startX=a,this.startY=i,this.touchStartEvent=t.touches}else{var n=t.touches[1].clientX-t.touches[0].clientX,s=t.touches[1].clientY-t.touches[0].clientY,o=Math.sqrt(n*n+s*s);u.x1=2*t.touches[0].pageX,u.y1=2*t.touches[0].pageY,u.x2=2*t.touches[1].pageX,u.y2=2*t.touches[1].pageY,this.setData({"stv.distance":o,"stv.zoom":!0})}},touchmoveCallback:function(t){this.touchMove(t)},touchendCallback:function(t){0===t.touches.length&&this.setData({"stv.zoom":!1})},touchMove:function(t){if(1===t.touches.length){if(this.data.stv.zoom)return;var e=t.touches[0],a=e.clientX,i=e.clientY,n=a-this.startX,s=i-this.startY;this.startX=a,this.startY=i;var o=this.data.stv;o.offsetX+=n,o.offsetY+=s,o.offsetLeftX=-o.offsetX,o.offsetLeftY=-o.offsetLeftY,this.setData({stv:o})}else if(2===t.touches.length){var c=JSON.parse(JSON.stringify(u));u.x1=2*t.touches[0].pageX,u.y1=2*t.touches[0].pageY,u.x2=2*t.touches[1].pageX;var l=new r.vector(c.x1,c.y1,c.x2,c.y2),d=new r.vector(u.x1,u.y1,u.x2,u.y2),h=(0,r.calculateVM)(l,d),f=180*Math.acos(h)/Math.PI,v=(0,r.calculateVM)(l,d),p=v*f,g=t.touches[1].clientX-t.touches[0].clientX,m=t.touches[1].clientY-t.touches[0].clientY,x=Math.sqrt(g*g+m*m),w=x-this.data.stv.distance;this.data.stv.scale;if(Math.abs(p)>1)this.setData({"stv.rotate":this.data.stv.rotate+p});else{var b=t.touches[1].clientX-t.touches[0].clientX,y=t.touches[1].clientY-t.touches[0].clientY,I=Math.sqrt(b*b+y*y),D=I-this.data.stv.distance,S=this.data.stv.scale+.005*D;if(S<.2||S>2.5)return;this.setData({"stv.distance":I,"stv.scale":S})}}},save:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:uni.createSelectorQuery().in(t).select("#main-canvas").fields({size:!0},(function(t){})).exec((function(e){var a=e[0].node,i=a.getContext("2d"),o=uni.getSystemInfoSync().pixelRatio;a.width=e[0].width*o,a.height=e[0].height*o,i.scale(o,o);var c=a.createImage();c.onload=(0,s.default)((0,n.default)().mark((function e(){var a,s,r,u,d,h,f,v;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i.scale(t.stv.scale,t.stv.scale),i.drawImage(c,t.stv.offsetX/t.stv.scale+(t.originImg.width/t.stv.scale-t.originImg.width)/2,t.stv.offsetY/t.stv.scale+(t.originImg.height/t.stv.scale-t.originImg.height)/2,t.originImg.width,t.originImg.height),a=t.imgRect,s=a.x,r=a.y,u=a.w,d=a.h,console.log(t.imgRect),h=i.getImageData(s*o,r*o,u,d),e.next=7,(0,l.getNode)("save-canvas");case 7:f=e.sent,f.width=u,f.height=d,v=f.getContext("2d"),v.fillStyle="green",v.fillRect(0,0,u,d),v.putImageData(h,0,0),t.saveToAb(f,0,0,u,d);case 15:case"end":return e.stop()}}),e)}))),c.src=t.file}));case 1:case"end":return e.stop()}}),e)})))()},saveToAb:function(t,e,a,i,n){}}});e.default=d},"99b3":function(t,e,a){"use strict";var i=a("254d"),n=a.n(i);n.a},cc37:function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.calculateVC=function(t,e){return t.x*e.y-e.x*t.y>0?1:-1},e.calculateVM=function(t,e){return(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y))},e.vector=void 0;var n=i(a("bee2")),s=i(a("d4ec")),o=i(a("ade3")),c=(0,n.default)((function t(e,a,i,n){(0,s.default)(this,t),(0,o.default)(this,"x",void 0),(0,o.default)(this,"y",void 0),this.x=i-e,this.y=n-a}));e.vector=c},de74:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"content"},[a("v-uni-view",{staticClass:"img",attrs:{id:"img"},on:{touchstart:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchstartCallback.apply(void 0,arguments)},touchmove:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchmoveCallback.apply(void 0,arguments)},touchend:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchendCallback.apply(void 0,arguments)}}},[a("v-uni-canvas",{attrs:{type:"2d","canvas-id":"viewone",id:"main-canvas"}}),a("v-uni-canvas",{attrs:{type:"2d","canvas-id":"viewtwo",id:"save-canvas"}}),a("v-uni-image",{style:"transform: translate("+t.stv.offsetX+"px, "+t.stv.offsetY+"px) scale("+t.stv.scale+");width:"+t.originImg.width+"px; height: "+t.originImg.height+"px",attrs:{src:t.originImg.url}}),a("v-uni-view",{staticClass:"mask",style:"grid-template-columns: auto "+t.photoSetting.pixelWidth/t.dpr+"px auto; grid-template-rows: auto "+t.photoSetting.pixelHeight/t.dpr+"px auto;"},[a("v-uni-view",{staticStyle:{"grid-column-start":"1","grid-column-end":"4"},attrs:{id:"top-view"}}),a("v-uni-view",{attrs:{id:"left-view"}},[a("v-uni-text",{staticClass:"r90"},[t._v(t._s(t.photoSetting.mmHeight)+" mm")])],1),a("v-uni-view",{staticStyle:{"grid-column-start":"3"}}),a("v-uni-view",{staticStyle:{"grid-column-start":"1","grid-column-end":"4"}},[a("v-uni-text",{staticStyle:{color:"#fff",top:"10px","text-align":"center",width:"100%"}},[t._v(t._s(t.photoSetting.mmWidth)+" mm")])],1)],1)],1),a("v-uni-view",{staticClass:"banner-view"},[a("v-uni-button",{staticStyle:{width:"90%"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.save.apply(void 0,arguments)}}},[t._v("保存到相册")])],1)],1)},n=[]},fe9a:function(t,e,a){"use strict";a("7a82"),Object.defineProperty(e,"__esModule",{value:!0}),e.photoItems=void 0;e.photoItems={1:{name:"一寸照片",type:"1",pixelHeight:413,pixelWidth:295,mmWidth:25,mmHeight:35,dip:"300DIP"},2:{name:"二寸照片",type:"2",pixelHeight:626,pixelWidth:413,mmWidth:35,mmHeight:53,dip:"300DIP"},3:{name:"国考照片",type:"3",pixelHeight:413,pixelWidth:295,mmWidth:25,mmHeight:35,dip:"300DIP"},4:{name:"身份证照片",type:"4",pixelHeight:441,pixelWidth:358,mmWidth:26,mmHeight:32,dip:"350DIP"}}}}]);